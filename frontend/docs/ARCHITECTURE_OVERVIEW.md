# ARCHITECTURE_OVERVIEW.md

## 🎯 目的

本ドキュメントは、避難所検索・AR案内システムの全体構成、マイクロシステム設計、データフロー、開発指針を定義し、全機能の整合性とアジャイルな拡張性を確保することを目的とする。

---

## 🧩 マイクロシステム一覧

| サービス名               | ファイル                            | 機能概要                                       |
| ------------------------ | ----------------------------------- | ---------------------------------------------- |
| 避難所検索サービス       | `EvacuationSearchService`           | 地名・災害種別での避難所検索（マップ表示含む） |
| 避難所管理サービス       | `EvacuationCenterManagementService` | 緊急避難所・指定避難所の登録・分類・座標管理   |
| 災害種別ポリゴンサービス | `DisasterZoneService`               | 洪水・津波など災害種別の領域ポリゴン処理       |
| 混雑度管理サービス       | `CrowdAndSupplyStatusService`       | 混雑度と必要物資の登録・取得                   |
| AR誘導サービス           | `RouteGuidanceService`              | ルート案内とAR表示連携機能（WebAR）            |
| 多言語サポート           | `MultilingualSupportService`        | UIと出力結果の多言語化対応                     |
| 管理者ダッシュボード     | `AdminDashboardService`             | 管理者による登録・統計・分析                   |
| ユーザーフィードバック   | `UserFeedbackService`               | 利用者の評価・不具合報告の受付                 |
| ユーザー管理             | `UserProfileService`                | 利用者情報とアクセス履歴の記録管理             |

---

## 🧱 データベース主要テーブル

| テーブル名            | 役割                                            |
| --------------------- | ----------------------------------------------- |
| `emergency_shelters`  | 災害対応型（flood等カラムあり）の緊急避難所情報 |
| `designated_shelters` | 指定避難所（高齢者・障がい者等の分類対象）      |
| `hazard_zones`        | 災害ごとのポリゴン領域情報（県別分割）          |
| `crowd_status`        | 混雑度と物資在庫ステータス管理                  |
| `users`               | ユーザーID・履歴情報（ログイン必須ではない）    |

---

## 🔄 データフロー概要

1. ユーザーが市名・災害種別を入力（例：札幌市 × 洪水）
2. `/api/search` にクエリ送信
3. `emergency_shelters` を hazard_flood = true でフィルター
4. マップ上に結果を表示（Google Maps API）
5. マーカー選択 → ルート表示（Directions API）
6. ARボタンで `evacuation_ar.html` に遷移し、現実空間で誘導

---

## 🚀 開発・運用方針

| 項目       | 内容                                                         |
| ---------- | ------------------------------------------------------------ |
| 言語・FW   | Flask (Python), React (JS), PostgreSQL                       |
| 地図連携   | Google Maps JavaScript API                                   |
| AR技術     | A-Frame + AR.js + GPS対応表示                                |
| デプロイ   | Cloudflare Tunnel（ローカル開発）, Azure/AWS（本番）         |
| 開発モデル | マイクロサービス + アジャイル開発 + 再利用可能コンポーネント |

---

## 🔧 今後の拡張予定

- 音声読み上げ対応
- 災害通知（プッシュ通知）対応
- 災害発生中ルートの危険判定機能（交差チェック）
- 災害種別フィルターの拡張（複数同時選択）
- モバイルオフライン対応

---

## 📝 バージョン管理とテスト

- GitHubにて `.md`・コード・SQLファイルを管理
- テストは `pytest`（バックエンド） + `Jest`（フロント）
- 手動によるマップUIとデータ整合性の確認も含む

---

## ✅ 状態

- 本ファイルは2025年6月最新版
- 本設計に従い、すべての機能を段階的に再構築する
